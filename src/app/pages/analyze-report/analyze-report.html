<!-- analyze-report.component.html -->
<div class="main-container">
  <div class="report-container">
    <header class="report-header">
      <img
        src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/NASA_logo.svg/2560px-NASA_logo.svg.png"
        alt="NASA Logo"
        class="nasa-logo"
      />
      <h1>📊 Informe de Análisis Ambiental</h1>
      <p class="subtitle">
        Generado con datos satelitales y abiertos (NASA POWER, OSM, WorldPop, GIBS)
      </p>
    </header>

    <div *ngIf="data; else noData" class="scrollable-content">
      <!-- 🌍 UBICACIÓN -->
      <div class="card card-location">
        <h2>🌍 Ubicación</h2>
        <div class="info-grid">
          <p><strong>Latitud:</strong> {{ data.location.lat }}</p>
          <p><strong>Longitud:</strong> {{ data.location.lon }}</p>
          <p><strong>País (ISO3):</strong> {{ data.location.iso3 }}</p>
        </div>
      </div>

      <!-- 👥 POBLACIÓN -->
      <div class="card card-population">
        <h2>👥 Población</h2>
        <p><strong>{{ data.population?.title }}</strong></p>
        <p>{{ data.population?.desc }}</p>

        <div class="img-wrapper" *ngIf="data.population?.url_img">
          <img [src]="data.population.url_img" alt="Mapa de población" />
          <p class="img-caption">🗺️ Distribución poblacional (WorldPop 2020)</p>
        </div>

        <p>
          <strong>Fuente:</strong>
          <a [href]="data.population?.url_summary" target="_blank">
            WorldPop, University of Southampton
          </a>
        </p>
      </div>

      <!-- 🌦️ CLIMA -->
      <div class="card card-climate">
        <h2>🌦️ Clima (NASA POWER)</h2>
        <div *ngIf="getClimateSummary() as clima">
          <div class="climate-stats">
            <div class="stat">
              <p>🌡️ <strong>Temperatura promedio</strong></p>
              <h3>{{ clima.avgTemp }} °C</h3>
            </div>
            <div class="stat">
              <p>💧 <strong>Precipitación promedio</strong></p>
              <h3>{{ clima.avgPrec }} mm/día</h3>
            </div>
          </div>
        </div>
        <p class="note">Datos procesados desde la API de NASA POWER (últimos 7 días).</p>
      </div>

      <!-- 💧 CUERPOS DE AGUA -->
      <div class="card card-water">
        <h2>💧 Cuerpos de Agua Cercanos</h2>
        <p>
          Se identificaron <strong>{{ data.water?.count || 0 }}</strong> cuerpos de agua dentro
          de un radio de 5 km.
        </p>
        <p class="note">Datos obtenidos de OpenStreetMap (Overpass API).</p>
      </div>

      <!-- 🛰️ IMAGEN SATELITAL -->
      <div class="card card-gibs" *ngIf="data.gibs?.imageUrl">
        <h2>🛰️ Imagen Satelital</h2>
        <div class="img-wrapper">
          <img [src]="data.gibs.imageUrl" alt="Imagen satelital NASA GIBS" />
          <p class="img-caption">🌍 Imagen satelital NASA GIBS (MODIS TrueColor)</p>
        </div>
      </div>

      <!-- 🔎 INTERPRETACIÓN -->
      <div class="card card-analysis">
        <h2>🔎 Interpretación Ambiental</h2>
        <div *ngIf="getClimateSummary() as clima" class="insight-grid">
          <div class="insight-card warm" *ngIf="+clima.avgTemp > 25">
            ☀️ <strong>Zona cálida:</strong> Podría presentar estrés hídrico en épocas secas.
          </div>

          <div
            class="insight-card mild"
            *ngIf="+clima.avgTemp <= 25 && +clima.avgTemp >= 15"
          >
            🌤️ <strong>Clima templado:</strong> Condiciones ideales para la vegetación moderada.
          </div>

          <div class="insight-card cold" *ngIf="+clima.avgTemp < 15">
            ❄️ <strong>Zona fría:</strong> Menor evapotranspiración, riesgo bajo de sequía.
          </div>

          <div class="insight-card rain" *ngIf="+clima.avgPrec > 5">
            🌧️ <strong>Alta precipitación:</strong> Posible riesgo de inundaciones o suelos saturados.
          </div>

          <div class="insight-card dry" *ngIf="+clima.avgPrec <= 5">
            🔥 <strong>Baja precipitación:</strong> Riesgo de sequías prolongadas o escasez de agua.
          </div>

          <div class="insight-card water" *ngIf="data.water?.count > 0">
            💦 <strong>Presencia hídrica:</strong> Se detectan fuentes de agua cercanas útiles para riego.
          </div>

          <div class="insight-card no-water" *ngIf="data.water?.count === 0">
            🚫 <strong>Sin cuerpos de agua visibles:</strong> Posible vulnerabilidad hídrica local.
          </div>
        </div>
        <p class="note">
          ⚠️ Estas observaciones son en base a la DATA obtenidad por los satelites de la NASA.
        </p>
      </div>

      <!-- 🔗 FUENTES -->
      <div class="card card-sources">
        <h2>🔗 Fuentes de Datos</h2>
        <ul>
          <li><a href="https://power.larc.nasa.gov/" target="_blank">NASA POWER</a></li>
          <li><a href="https://gibs.earthdata.nasa.gov/" target="_blank">NASA GIBS</a></li>
          <li><a href="https://hub.worldpop.org/" target="_blank">WorldPop</a></li>
          <li><a href="https://www.openstreetmap.org/" target="_blank">OpenStreetMap</a></li>
        </ul>
      </div>

      <div class="back-btn">
        <button routerLink="/map">⬅️ Volver al mapa</button>
      </div>
    </div>

    <ng-template #noData>
      <p class="no-data">⚠️ No hay datos cargados. Regresa al mapa e inicia un nuevo análisis.</p>
    </ng-template>
  </div>
</div>
